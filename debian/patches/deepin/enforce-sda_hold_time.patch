commit 4cca850b9ad21d83c60efa0d3bd0fd22ad58de4b
Author: Yang Bo <yangbo@deepin.com>
Date:   Thu Aug 25 16:26:14 2016 +0800

    Enforce sda_hold_time
    
    Signed-off-by: Yang Bo <yangbo@deepin.com>

diff --git a/drivers/i2c/busses/i2c-designware-platdrv.c b/drivers/i2c/busses/i2c-designware-platdrv.c
index ccb25ef..e39ac83 100644
--- a/drivers/i2c/busses/i2c-designware-platdrv.c
+++ b/drivers/i2c/busses/i2c-designware-platdrv.c
@@ -227,6 +227,21 @@ static int dw_i2c_plat_probe(struct platform_device *pdev)
 				(u64)dev->get_clk_rate_khz(dev) * ht + 500000,
 				1000000);
 	}
+    
+	dev_err(&pdev->dev, "sda_hold_time (%d), ht (%d)\n", dev->sda_hold_time, ht);
+    if (!dev->sda_hold_time) {
+        if (!ht) {
+            ht = 230;
+        }
+
+		dev->get_clk_rate_khz = i2c_dw_get_clk_rate_khz;
+
+		dev->sda_hold_time = div_u64(
+				(u64)dev->get_clk_rate_khz(dev) * ht + 500000,
+				1000000);
+
+		dev_err(&pdev->dev, "sda_hold_time (%d), ht (%d)\n", dev->sda_hold_time, ht);
+    }
 
 	if (!dev->tx_fifo_depth) {
 		u32 param1 = i2c_dw_read_comp_param(dev);
