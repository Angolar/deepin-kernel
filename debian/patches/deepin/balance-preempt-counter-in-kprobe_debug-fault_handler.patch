commit a46fd69b9e6cc56159183b52e7ac854fcebaa23b
Author: Yang Bo <yangbo@deepin.com>
Date:   Sat Jan 13 12:42:15 2018 +0800

    x86/kprobe: unblanced preempt counter in {debug,fault}_handler
    
    Signed-off-by: Yang Bo <yangbo@deepin.com>

diff --git a/arch/x86/kernel/kprobes/core.c b/arch/x86/kernel/kprobes/core.c
index 2f582111a..f2181fc1a 100644
--- a/arch/x86/kernel/kprobes/core.c
+++ b/arch/x86/kernel/kprobes/core.c
@@ -934,7 +934,6 @@ int kprobe_debug_handler(struct pt_regs *regs)
 	}
 	reset_current_kprobe();
 out:
-	preempt_enable_no_resched();
 
 	/*
 	 * if somebody else is singlestepping across a probe point, flags
@@ -982,7 +981,6 @@ int kprobe_fault_handler(struct pt_regs *regs, int trapnr)
 			restore_previous_kprobe(kcb);
 		else
 			reset_current_kprobe();
-		preempt_enable_no_resched();
 	} else if (kcb->kprobe_status == KPROBE_HIT_ACTIVE ||
 		   kcb->kprobe_status == KPROBE_HIT_SSDONE) {
 		/*
